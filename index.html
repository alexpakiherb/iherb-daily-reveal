<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>iHerb — Your Daily Reveal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --green-50:#f0f7e8;--green-100:#dcefc8;--green-200:#b8df8f;--green-500:#5a9e14;--green-600:#46820b;--green-700:#3a6d09;--green-800:#2d5a06;
    --gold-400:#f0d060;--gold-500:#d4a017;
    --amber-50:#fffbeb;--amber-100:#fef3c7;--amber-600:#d97706;
    --slate-50:#f8fafc;--slate-100:#f1f5f9;--slate-200:#e2e8f0;--slate-300:#cbd5e1;--slate-400:#94a3b8;--slate-500:#64748b;--slate-600:#475569;--slate-700:#334155;--slate-800:#1e293b;--slate-900:#0f172a;
    --radius-lg:22px;--radius-md:14px;--radius-sm:10px;--radius-full:9999px;
    --shadow-card:0 8px 40px rgba(0,0,0,.10),0 1px 6px rgba(0,0,0,.04);
    --shadow-card-hover:0 16px 56px rgba(0,0,0,.14),0 2px 8px rgba(0,0,0,.06);
    --shadow-elevated:0 24px 80px rgba(0,0,0,.12),0 4px 16px rgba(0,0,0,.06);
    --ease-out-expo:cubic-bezier(.16,1,.3,1);
    --ease-spring:cubic-bezier(.34,1.56,.64,1);
    --ease-soft:cubic-bezier(.25,.8,.25,1);
  }
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:linear-gradient(180deg,#f4f6f3 0%,#eef1eb 100%);color:var(--slate-800);min-height:100vh;min-height:100dvh;overflow-x:hidden;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}

  /* ── Header ── */
  .header{background:linear-gradient(135deg,var(--green-700) 0%,var(--green-800) 100%);color:#fff;padding:0 20px;height:58px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 2px 12px rgba(0,0,0,.12),0 1px 0 rgba(0,0,0,.08)}
  .header-logo{font-size:23px;font-weight:900;letter-spacing:-.6px;text-shadow:0 1px 2px rgba(0,0,0,.15)}
  .header-logo span{color:var(--gold-400);font-size:7px;vertical-align:middle;margin-left:2px;filter:drop-shadow(0 0 3px rgba(240,208,96,.4))}
  .header-icons{display:flex;gap:22px;align-items:center}
  .header-icon{width:21px;height:21px;opacity:.8;cursor:pointer;transition:all .2s var(--ease-soft)}
  .header-icon:hover{opacity:1;transform:scale(1.1)}
  .header-icon:active{transform:scale(.9);opacity:1}
  .notif-dot{width:7px;height:7px;background:#ef4444;border-radius:50%;position:absolute;top:-2px;right:-2px;border:2px solid var(--green-700);box-shadow:0 0 0 0 rgba(239,68,68,.4);animation:notif-pulse 2s infinite}
  @keyframes notif-pulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.4)}50%{box-shadow:0 0 0 4px rgba(239,68,68,0)}}

  /* ── Goals Banner ── */
  .goals-banner{background:#fff;padding:16px 20px 18px;border-bottom:1px solid var(--slate-200);cursor:pointer;transition:all .2s var(--ease-soft);-webkit-tap-highlight-color:transparent;position:relative;overflow:hidden}
  .goals-banner::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--green-500),var(--gold-400),var(--green-500));opacity:.5}
  .goals-banner:active{background:var(--slate-50);transform:scale(.995)}
  .goals-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
  .goals-label-group{display:flex;flex-direction:column;gap:2px}
  .goals-label{font-size:13.5px;font-weight:700;color:var(--slate-800);letter-spacing:-.15px}
  .goals-label-sub{font-size:11px;color:var(--slate-400);font-weight:500}
  .goals-edit-btn{background:var(--green-600);border:none;font-family:'Inter',sans-serif;font-size:12px;font-weight:700;color:#fff;cursor:pointer;padding:8px 16px;display:flex;align-items:center;gap:6px;transition:all .2s var(--ease-soft);border-radius:var(--radius-full);white-space:nowrap;-webkit-tap-highlight-color:transparent;box-shadow:0 2px 8px rgba(70,130,11,.25)}
  .goals-edit-btn:hover{background:var(--green-500);box-shadow:0 4px 14px rgba(70,130,11,.3);transform:translateY(-1px)}
  .goals-edit-btn:active{transform:scale(.95) translateY(0)}
  .goals-edit-btn svg{width:12px;height:12px}
  .goals-tags{display:flex;gap:7px;flex-wrap:wrap}
  .goal-tag{background:var(--green-50);border:1px solid var(--green-100);color:var(--green-700);padding:5px 13px;border-radius:var(--radius-full);font-size:11.5px;font-weight:600;letter-spacing:-.1px;transition:all .2s var(--ease-soft);animation:tag-in .4s var(--ease-spring) backwards}
  .goal-tag:nth-child(1){animation-delay:.05s}.goal-tag:nth-child(2){animation-delay:.1s}.goal-tag:nth-child(3){animation-delay:.15s}.goal-tag:nth-child(4){animation-delay:.2s}
  @keyframes tag-in{0%{opacity:0;transform:scale(.8) translateY(4px)}}

  /* ── Goal Editor Modal ── */
  .goals-modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0);backdrop-filter:blur(0px);-webkit-backdrop-filter:blur(0px);z-index:200;align-items:flex-end;justify-content:center;transition:background .3s,backdrop-filter .3s}
  .goals-modal-overlay.open{display:flex;animation:overlay-in .35s forwards}
  @keyframes overlay-in{to{background:rgba(0,0,0,.5);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}}
  .goals-modal{background:#fff;border-radius:24px 24px 0 0;width:100%;max-width:540px;max-height:80vh;max-height:80dvh;overflow-y:auto;padding:0;animation:sheet-up .45s var(--ease-spring);box-shadow:0 -8px 40px rgba(0,0,0,.12)}
  @keyframes sheet-up{0%{transform:translateY(100%);opacity:.5}100%{transform:translateY(0);opacity:1}}
  .goals-modal-header{padding:24px 24px 0;display:flex;align-items:center;justify-content:space-between}
  .goals-modal-header::before{content:'';position:absolute;top:10px;left:50%;transform:translateX(-50%);width:36px;height:4px;background:var(--slate-200);border-radius:2px}
  .goals-modal-header h3{font-size:18px;font-weight:800;color:var(--slate-900);letter-spacing:-.3px}
  .goals-modal-close{background:var(--slate-100);border:none;width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .2s var(--ease-soft);-webkit-tap-highlight-color:transparent}
  .goals-modal-close:hover{background:var(--slate-200);transform:rotate(90deg)}
  .goals-modal-close:active{transform:scale(.9)}
  .goals-modal-close svg{width:14px;height:14px;stroke:var(--slate-500)}
  .goals-modal-sub{font-size:13px;color:var(--slate-400);padding:8px 24px 18px;line-height:1.55}
  .goals-grid{display:flex;flex-wrap:wrap;gap:9px;padding:0 24px 24px}
  .goal-option{padding:10px 18px;border-radius:var(--radius-full);font-family:'Inter',sans-serif;font-size:13px;font-weight:600;border:1.5px solid var(--slate-200);background:#fff;color:var(--slate-600);cursor:pointer;transition:all .2s var(--ease-soft);display:flex;align-items:center;gap:7px;-webkit-tap-highlight-color:transparent}
  .goal-option:hover{border-color:var(--green-200);background:var(--green-50);transform:translateY(-1px)}
  .goal-option:active{transform:scale(.96)}
  .goal-option.selected{background:var(--green-600);color:#fff;border-color:var(--green-600);box-shadow:0 3px 12px rgba(70,130,11,.3)}
  .goal-option.selected:hover{background:var(--green-500);border-color:var(--green-500)}
  .goal-check{width:16px;height:16px;border-radius:50%;border:1.5px solid var(--slate-300);display:flex;align-items:center;justify-content:center;transition:all .2s var(--ease-spring);flex-shrink:0}
  .goal-option.selected .goal-check{background:#fff;border-color:#fff;transform:scale(1.1)}
  .goal-option.selected .goal-check svg{opacity:1}
  .goal-option .goal-check svg{opacity:0;transition:opacity .15s}
  .goals-modal-footer{padding:16px 24px 32px;border-top:1px solid var(--slate-100)}
  .goals-save-btn{width:100%;padding:15px;border:none;border-radius:var(--radius-md);font-family:'Inter',sans-serif;font-size:15px;font-weight:700;color:#fff;background:linear-gradient(135deg,var(--green-600),var(--green-500));cursor:pointer;transition:all .2s var(--ease-soft);-webkit-tap-highlight-color:transparent;box-shadow:0 4px 16px rgba(70,130,11,.25)}
  .goals-save-btn:hover{box-shadow:0 6px 24px rgba(70,130,11,.35);transform:translateY(-1px)}
  .goals-save-btn:active{transform:scale(.97) translateY(0)}
  .goals-count{font-size:12px;color:var(--slate-400);text-align:center;margin-top:10px}

  /* ── Main Content ── */
  .main{max-width:480px;margin:0 auto;padding:28px 16px 100px}
  @media(min-width:768px){.main{max-width:520px;padding:36px 24px 100px}}
  .section-header{margin-bottom:24px}
  .section-title{font-size:24px;font-weight:900;letter-spacing:-.6px;color:var(--slate-900);line-height:1.15}
  .section-subtitle{font-size:13.5px;color:var(--slate-400);margin-top:6px;line-height:1.55;letter-spacing:-.1px}

  /* ── Card Stack ── */
  .card-stack{position:relative;min-height:500px;margin-bottom:12px;perspective:1200px;transition:min-height .5s var(--ease-out-expo)}
  .card-stack.collapsed{min-height:0}
  .scratch-card{position:absolute;width:100%;border-radius:var(--radius-lg);overflow:visible;transition:transform .6s var(--ease-out-expo),opacity .5s ease,filter .5s ease;user-select:none;-webkit-user-select:none;will-change:transform;touch-action:pan-y}
  .scratch-card.behind-1{transform:scale(.94) translateY(14px);opacity:.4;z-index:1;filter:blur(2px)}
  .scratch-card.behind-2{transform:scale(.88) translateY(28px);opacity:.15;z-index:0;filter:blur(4px)}
  .scratch-card.active{transform:scale(1) translateY(0);z-index:10;filter:none}
  .scratch-card.dismissed{z-index:20;pointer-events:none;transition:transform .55s var(--ease-out-expo),opacity .4s ease}
  .scratch-card.slide-out{transform:translateY(-30px) scale(.92);opacity:0}

  /* ── Card Front ── */
  .card-front{border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-card);cursor:pointer;position:relative;-webkit-tap-highlight-color:transparent;transition:box-shadow .3s var(--ease-soft),transform .3s var(--ease-soft)}
  .card-front:hover{box-shadow:var(--shadow-elevated)}
  .card-front:hover .card-scene{transform:scale(1.04)}
  .card-front:active{transform:scale(.985)}
  .card-scene{width:100%;height:500px;transition:transform .8s var(--ease-out-expo)}
  .card-front-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 20%,rgba(0,0,0,.04) 40%,rgba(0,0,0,.55) 85%,rgba(0,0,0,.72) 100%);border-radius:var(--radius-lg)}
  .card-front-content{position:absolute;bottom:0;left:0;right:0;padding:32px 24px;color:#fff;transition:transform .15s ease}
  .card-front-tag{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.1);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.12);padding:6px 14px;border-radius:var(--radius-full);font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:.9px;margin-bottom:14px}
  .tag-dot{width:6px;height:6px;border-radius:50%;background:#7dd956;box-shadow:0 0 8px rgba(125,217,86,.6);animation:dot-glow 2s ease-in-out infinite}
  @keyframes dot-glow{0%,100%{box-shadow:0 0 6px rgba(125,217,86,.5)}50%{box-shadow:0 0 12px rgba(125,217,86,.8)}}
  .card-front-title{font-size:28px;font-weight:900;letter-spacing:-.7px;line-height:1.12;margin-bottom:8px;text-shadow:0 2px 16px rgba(0,0,0,.35)}
  .card-front-desc{font-size:14px;opacity:.78;line-height:1.5;font-weight:400;max-width:300px;text-shadow:0 1px 6px rgba(0,0,0,.2)}
  .card-front-cta{margin-top:22px;display:inline-flex;align-items:center;gap:8px;background:#fff;color:var(--slate-800);padding:13px 26px;border-radius:var(--radius-full);font-size:13.5px;font-weight:700;letter-spacing:-.2px;cursor:pointer;transition:all .25s var(--ease-spring);box-shadow:0 4px 20px rgba(0,0,0,.18)}
  .card-front-cta:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(0,0,0,.22)}
  .card-front-cta:active{transform:scale(.95)}
  .cta-arrow{display:inline-flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:50%;background:var(--green-600);transition:all .25s var(--ease-spring)}
  .card-front-cta:hover .cta-arrow{transform:translateX(3px);background:var(--green-500)}

  /* ── Shimmer on front card ── */
  .card-front::after{content:'';position:absolute;top:0;left:-60%;width:50%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent);transform:skewX(-15deg);animation:shimmer 4s ease-in-out infinite;pointer-events:none}
  @keyframes shimmer{0%,100%{left:-60%}50%{left:110%}}

  /* ── Card Back (Reveal) ── */
  .card-back{display:none;border-radius:var(--radius-lg);overflow:hidden;box-shadow:var(--shadow-elevated);background:#fff;animation:reveal-pop .55s var(--ease-spring) forwards}
  @keyframes reveal-pop{0%{transform:scale(.9) rotateX(6deg);opacity:0}50%{transform:scale(1.02) rotateX(-1deg);opacity:1}100%{transform:scale(1) rotateX(0);opacity:1}}
  .reveal-hero{position:relative;height:170px;overflow:hidden}
  .reveal-hero-overlay{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 10%,rgba(0,0,0,.55) 100%)}
  .reveal-hero-content{position:absolute;bottom:0;left:0;right:0;padding:20px 22px;color:#fff}
  .reveal-goal-pill{display:inline-flex;align-items:center;gap:5px;padding:4px 12px;border-radius:var(--radius-full);font-size:10px;font-weight:700;margin-bottom:8px;background:rgba(255,255,255,.15);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.18);text-transform:uppercase;letter-spacing:.7px}
  .reveal-discount{font-size:38px;font-weight:900;line-height:1;letter-spacing:-1.8px;text-shadow:0 2px 10px rgba(0,0,0,.3)}
  .reveal-discount-sub{font-size:12px;font-weight:500;opacity:.8;margin-top:3px}

  .reveal-body{padding:22px 20px 20px}
  .product-card{display:flex;gap:16px;padding:16px;background:var(--slate-50);border-radius:var(--radius-md);border:1px solid var(--slate-100);margin-bottom:16px;transition:all .2s var(--ease-soft)}
  .product-card:active{transform:scale(.98)}
  .product-thumb-wrap{width:72px;height:72px;border-radius:var(--radius-sm);flex-shrink:0;overflow:hidden;border:1px solid var(--slate-100);background:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px rgba(0,0,0,.04)}
  .product-thumb-wrap svg{width:54px;height:54px}
  .product-details{flex:1;min-width:0}
  .product-brand{font-size:9px;text-transform:uppercase;letter-spacing:1.1px;color:var(--slate-400);font-weight:700;margin-bottom:3px}
  .product-name{font-size:13.5px;font-weight:700;color:var(--slate-800);line-height:1.35;margin-bottom:5px;letter-spacing:-.1px}
  .product-rating{font-size:11px;color:var(--slate-400);display:flex;align-items:center;gap:4px}
  .stars{color:#f59e0b;letter-spacing:-1px;font-size:12px}
  .product-pricing{display:flex;align-items:baseline;gap:8px;margin-top:6px}
  .price-was{font-size:12px;color:var(--slate-400);text-decoration:line-through}
  .price-now{font-size:18px;font-weight:800;color:var(--green-700);letter-spacing:-.3px}

  .ai-insight{background:linear-gradient(135deg,var(--slate-50),#f7f9f5);border-radius:var(--radius-md);padding:16px;margin-bottom:18px;border:1px solid var(--slate-100);overflow:hidden;position:relative}
  .ai-insight::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--green-200),transparent)}
  .ai-text-wrap{min-height:var(--ai-height,80px)}
  .ai-label{display:flex;align-items:center;gap:8px;font-size:10px;text-transform:uppercase;letter-spacing:.9px;font-weight:700;margin-bottom:10px;color:var(--green-700)}
  .ai-icon{width:20px;height:20px;border-radius:6px;background:linear-gradient(135deg,var(--green-600),var(--green-500));display:flex;align-items:center;justify-content:center;flex-shrink:0;box-shadow:0 2px 6px rgba(70,130,11,.2)}
  .ai-icon svg{width:11px;height:11px}
  .ai-text{font-size:13px;color:var(--slate-600);line-height:1.7;letter-spacing:-.1px}
  .ai-cursor{display:inline-block;width:2px;height:14px;background:var(--green-600);margin-left:1px;vertical-align:text-bottom;border-radius:1px;animation:blink .75s step-end infinite}
  @keyframes blink{50%{opacity:0}}

  .cta-stack{display:flex;flex-direction:column;gap:10px}
  .btn-add{width:100%;padding:15px 24px;border:none;border-radius:var(--radius-md);font-family:'Inter',sans-serif;font-size:15px;font-weight:700;color:#fff;cursor:pointer;transition:all .2s var(--ease-spring);display:flex;align-items:center;justify-content:center;gap:8px;letter-spacing:-.2px;background:linear-gradient(135deg,var(--green-600),var(--green-500));-webkit-tap-highlight-color:transparent;box-shadow:none;position:relative;overflow:hidden}
  .btn-add::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);transition:left .4s}
  .btn-add:hover::after{left:100%}
  .btn-add:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(70,130,11,.2)}
  .btn-add:active{transform:scale(.97) translateY(0)}
  .btn-add.added{background:var(--green-800);box-shadow:none}
  .btn-save{width:100%;padding:13px 24px;background:transparent;border:1.5px solid var(--slate-200);border-radius:var(--radius-md);font-family:'Inter',sans-serif;font-size:13px;font-weight:600;color:var(--slate-500);cursor:pointer;transition:all .2s var(--ease-soft);-webkit-tap-highlight-color:transparent}
  .btn-save:hover{border-color:var(--slate-300);color:var(--slate-600);background:var(--slate-50)}
  .btn-save:active{transform:scale(.97)}

  .timer-strip{display:flex;align-items:center;justify-content:center;gap:6px;padding:12px 16px;font-size:11.5px;font-weight:600;color:var(--amber-600);background:linear-gradient(135deg,var(--amber-50),#fffdf5);border-top:1px solid var(--amber-100)}
  .timer-strip svg{width:14px;height:14px;stroke:var(--amber-600);flex-shrink:0;animation:tick 1s steps(1) infinite}
  @keyframes tick{50%{opacity:.5}}

  .cards-remaining{text-align:center;font-size:12.5px;color:var(--slate-400);margin-top:18px;font-weight:500;letter-spacing:-.1px}
  .cards-remaining strong{color:var(--green-600)}

  /* ── Empty State ── */
  .empty-state{display:none;text-align:center;padding:36px 20px}
  .empty-state.visible{display:block;animation:fade-in .5s var(--ease-spring)}
  @keyframes fade-in{0%{opacity:0;transform:translateY(16px)}100%{opacity:1;transform:translateY(0)}}
  .empty-wrap{background:#fff;border-radius:var(--radius-lg);padding:44px 32px;box-shadow:0 4px 24px rgba(0,0,0,.06)}
  .empty-icon{width:60px;height:60px;border-radius:50%;background:linear-gradient(135deg,var(--green-50),var(--green-100));display:flex;align-items:center;justify-content:center;margin:0 auto 18px;animation:icon-bounce 2s ease-in-out infinite}
  @keyframes icon-bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
  .empty-icon svg{width:26px;height:26px;stroke:var(--green-600)}
  .empty-wrap h3{font-size:19px;font-weight:800;color:var(--slate-800);margin-bottom:8px;letter-spacing:-.3px}
  .empty-wrap p{font-size:13.5px;color:var(--slate-400);line-height:1.6;max-width:280px;margin:0 auto}

  /* ── Confetti ── */
  .confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;overflow:hidden}
  .confetti-piece{position:absolute;top:-20px;will-change:transform;animation:confetti-drop var(--fall-duration,2.6s) cubic-bezier(.25,.46,.45,.94) forwards}
  @keyframes confetti-drop{0%{transform:translateY(0) rotate(0deg) scale(1);opacity:1}75%{opacity:1}100%{transform:translateY(100vh) rotate(var(--spin,720deg)) scale(.1);opacity:0}}

  /* ── Toast ── */
  .toast{position:fixed;bottom:32px;left:50%;transform:translateX(-50%) translateY(80px) scale(.9);background:var(--slate-900);color:#fff;padding:13px 24px;border-radius:var(--radius-full);font-size:13.5px;font-weight:600;z-index:2000;transition:all .4s var(--ease-spring);white-space:nowrap;box-shadow:0 8px 32px rgba(0,0,0,.2);letter-spacing:-.1px;backdrop-filter:blur(8px);display:flex;align-items:center;gap:8px}
  .toast.visible{transform:translateX(-50%) translateY(0) scale(1)}
  .toast-icon{width:18px;height:18px;border-radius:50%;background:var(--green-500);display:flex;align-items:center;justify-content:center;flex-shrink:0}
  .toast-icon svg{width:10px;height:10px}

  /* ── Progress dots ── */
  .progress-dots{display:flex;justify-content:center;gap:8px;margin-top:14px}
  .progress-dot{width:8px;height:8px;border-radius:50%;background:var(--slate-200);transition:all .4s var(--ease-spring)}
  .progress-dot.active{background:var(--green-500);box-shadow:0 0 8px rgba(90,158,20,.3);transform:scale(1.2)}
  .progress-dot.done{background:var(--green-200)}

  /* ── Haptic tap pulse ── */
  @keyframes tap-pulse{0%{box-shadow:0 0 0 0 rgba(90,158,20,.3)}100%{box-shadow:0 0 0 18px rgba(90,158,20,0)}}

  /* ── Reduced motion ── */
  @media(prefers-reduced-motion:reduce){*,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}}
</style>
</head>
<body>

<div class="header">
  <div class="header-logo">iHerb<span>●</span></div>
  <div class="header-icons">
    <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
    <div style="position:relative">
      <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 01-3.46 0"/></svg>
      <div class="notif-dot"></div>
    </div>
    <svg class="header-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
  </div>
</div>

<div class="goals-banner" onclick="openGoalsEditor()">
  <div class="goals-header">
    <div class="goals-label-group">
      <div class="goals-label">Your Wellness Goals</div>
      <div class="goals-label-sub">Tap to personalize your daily reveals</div>
    </div>
    <button class="goals-edit-btn" onclick="event.stopPropagation(); openGoalsEditor()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Edit
    </button>
  </div>
  <div class="goals-tags" id="goalsDisplay"></div>
</div>

<div class="goals-modal-overlay" id="goalsModal" onclick="if(event.target===this)closeGoalsEditor()">
  <div class="goals-modal">
    <div class="goals-modal-header" style="position:relative">
      <h3>Edit wellness goals</h3>
      <button class="goals-modal-close" onclick="closeGoalsEditor()"><svg viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    </div>
    <div class="goals-modal-sub">Select the goals that matter most to you. Your reveals will be personalized to match.</div>
    <div class="goals-grid" id="goalsGrid"></div>
    <div class="goals-modal-footer">
      <button class="goals-save-btn" onclick="saveGoals()">Update My Goals</button>
      <div class="goals-count" id="goalsCount"></div>
    </div>
  </div>
</div>

<div class="main">
  <div class="section-header">
    <div class="section-title">Your Daily Reveal</div>
    <div class="section-subtitle">Tap to unwrap personalized wellness surprises matched to your goals.</div>
  </div>
  <div class="card-stack" id="cardStack"></div>
  <div class="progress-dots" id="progressDots"></div>
  <div class="cards-remaining" id="cardsRemaining"></div>
  <div class="empty-state" id="emptyState">
    <div class="empty-wrap">
      <div class="empty-icon"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
      <h3>All reveals unlocked!</h3>
      <p>Come back tomorrow for fresh personalized wellness surprises tailored to your goals.</p>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<div class="confetti-container" id="confetti"></div>

<script>
// ── Scene generators ──
function makeScene(id, bg1, bg2, accent1, accent2, elements) {
  return `<svg class="card-scene" viewBox="0 0 500 500" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="${id}g1" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="${bg1}"/><stop offset="100%" stop-color="${bg2}"/></linearGradient>
      <radialGradient id="${id}g2" cx="70%" cy="30%" r="60%"><stop offset="0%" stop-color="${accent1}" stop-opacity=".3"/><stop offset="100%" stop-color="transparent"/></radialGradient>
      <radialGradient id="${id}g3" cx="20%" cy="80%" r="50%"><stop offset="0%" stop-color="${accent2}" stop-opacity=".2"/><stop offset="100%" stop-color="transparent"/></radialGradient>
      <filter id="${id}glow"><feGaussianBlur stdDeviation="2" result="blur"/><feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
    </defs>
    <rect width="500" height="500" fill="url(#${id}g1)"/>
    <rect width="500" height="500" fill="url(#${id}g2)"/>
    <rect width="500" height="500" fill="url(#${id}g3)"/>
    ${elements}
    <!-- Floating particles -->
    <g fill="#fff" opacity=".15">
      <circle cx="80" cy="120" r="1.5"><animate attributeName="cy" values="120;110;120" dur="4s" repeatCount="indefinite"/></circle>
      <circle cx="420" cy="380" r="1"><animate attributeName="cy" values="380;370;380" dur="3s" repeatCount="indefinite"/></circle>
      <circle cx="350" cy="80" r="1.2"><animate attributeName="cy" values="80;72;80" dur="3.5s" repeatCount="indefinite"/></circle>
    </g>
  </svg>`;
}

function makeHero(id, bg1, bg2, accent) {
  return `<svg width="100%" height="100%" viewBox="0 0 500 200" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="${id}h" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="${bg1}"/><stop offset="100%" stop-color="${bg2}"/></linearGradient></defs>
    <rect width="500" height="200" fill="url(#${id}h)"/>
    <circle cx="400" cy="50" r="80" fill="${accent}" opacity=".1"/><circle cx="80" cy="160" r="60" fill="${accent}" opacity=".06"/>
    <path d="M0 160 Q120 130 250 155 Q380 180 500 150 L500 200 L0 200Z" fill="${bg1}" opacity=".35"/>
  </svg>`;
}

const SCENE_ELEMENTS = {
  // Focus — converging light rays with a central focal point
  focus: `<g opacity=".06" stroke="#fff" stroke-width=".5" fill="none"><path d="M250 250 L50 50"/><path d="M250 250 L450 50"/><path d="M250 250 L50 450"/><path d="M250 250 L450 450"/><path d="M250 250 L250 30"/><path d="M250 250 L250 470"/><path d="M250 250 L30 250"/><path d="M250 250 L470 250"/></g><circle cx="250" cy="250" r="40" fill="#fff" opacity=".04"/><circle cx="250" cy="250" r="25" fill="#fff" opacity=".05"/><circle cx="250" cy="250" r="8" fill="#fff" opacity=".1"/><g opacity=".04" stroke="#fff" stroke-width=".5" fill="none"><ellipse cx="250" cy="250" rx="120" ry="60" transform="rotate(30 250 250)"/><ellipse cx="250" cy="250" rx="120" ry="60" transform="rotate(-30 250 250)"/><ellipse cx="250" cy="250" rx="120" ry="60"/></g>`,

  // Sleep — crescent moon silhouette with star field and soft aurora
  sleep: `<circle cx="370" cy="115" r="52" fill="#c4b5fd" opacity=".08"/><circle cx="385" cy="105" r="48" fill="#1a0a3e"/><g fill="#e9d5ff" opacity=".25"><circle cx="65" cy="55" r="1.2"/><circle cx="130" cy="85" r=".8"/><circle cx="200" cy="35" r="1.5"/><circle cx="285" cy="65" r="1"/><circle cx="420" cy="50" r=".8"/><circle cx="460" cy="175" r="1.2"/><circle cx="100" cy="180" r=".7"/><circle cx="320" cy="45" r="1"/><circle cx="170" cy="140" r=".6"/><circle cx="440" cy="120" r=".9"/></g><path d="M0 360 Q60 340 130 355 Q200 370 280 350 Q360 330 440 345 Q480 355 500 348 L500 500 L0 500Z" fill="#2d1b69" opacity=".25"/><path d="M0 400 Q80 380 170 395 Q260 410 350 390 Q440 370 500 385 L500 500 L0 500Z" fill="#1a0a3e" opacity=".2"/>`,

  // Recovery — flowing wave forms suggesting renewal and circulation
  recovery: `<g opacity=".06" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round"><path d="M0 200 Q60 160 125 200 Q190 240 250 200 Q310 160 375 200 Q440 240 500 200"/><path d="M0 250 Q60 210 125 250 Q190 290 250 250 Q310 210 375 250 Q440 290 500 250"/><path d="M0 300 Q60 260 125 300 Q190 340 250 300 Q310 260 375 300 Q440 340 500 300"/></g><g opacity=".04" fill="#fff"><path d="M0 200 Q60 160 125 200 Q190 240 250 200 Q310 160 375 200 Q440 240 500 200 L500 250 Q440 290 375 250 Q310 210 250 250 Q190 290 125 250 Q60 210 0 250Z"/></g><circle cx="140" cy="170" r="30" fill="#fb923c" opacity=".04"/><circle cx="360" cy="280" r="25" fill="#fb923c" opacity=".03"/>`,

  // Energy — radiant burst with concentric rings
  energy: `<g opacity=".06" stroke="#fbbf24" stroke-width=".8" fill="none"><circle cx="250" cy="230" r="40"/><circle cx="250" cy="230" r="70"/><circle cx="250" cy="230" r="105"/><circle cx="250" cy="230" r="145"/></g><g opacity=".04" stroke="#fff" stroke-width="1" fill="none" stroke-linecap="round"><path d="M250 90 L250 130"/><path d="M250 330 L250 370"/><path d="M110 230 L150 230"/><path d="M350 230 L390 230"/><path d="M153 133 L181 161"/><path d="M319 299 L347 327"/><path d="M153 327 L181 299"/><path d="M319 161 L347 133"/></g><circle cx="250" cy="230" r="20" fill="#fbbf24" opacity=".06"/><circle cx="250" cy="230" r="6" fill="#fff" opacity=".08"/>`,

  // Immunity — hexagonal grid pattern (cellular defense)
  immunity: `<g opacity=".05" stroke="#fff" stroke-width=".8" fill="none"><path d="M250 130 L290 153 L290 199 L250 222 L210 199 L210 153Z"/><path d="M170 170 L210 193 L210 239 L170 262 L130 239 L130 193Z"/><path d="M330 170 L370 193 L370 239 L330 262 L290 239 L290 193Z"/><path d="M250 250 L290 273 L290 319 L250 342 L210 319 L210 273Z"/><path d="M170 290 L210 313 L210 359 L170 382 L130 359 L130 313Z"/><path d="M330 290 L370 313 L370 359 L330 382 L290 359 L290 313Z"/></g><g fill="#4ade80" opacity=".06"><circle cx="250" cy="176" r="12"/><circle cx="170" cy="216" r="10"/><circle cx="330" cy="216" r="10"/><circle cx="250" cy="296" r="10"/></g>`,

  // Gut — organic flowing S-curves and scattered micro elements
  gut: `<g opacity=".06" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round"><path d="M120 100 Q180 140 200 200 Q220 280 280 300 Q340 320 360 380 Q380 420 340 450"/></g><g opacity=".03" fill="#fff"><path d="M120 100 Q180 140 200 200 Q220 280 280 300 Q340 320 360 380 Q380 420 340 450 Q320 430 340 380 Q310 320 260 300 Q200 280 180 200 Q160 140 120 100Z"/></g><g fill="#a3e635" opacity=".08"><circle cx="175" cy="165" r="6"/><circle cx="215" cy="240" r="5"/><circle cx="260" cy="285" r="7"/><circle cx="310" cy="325" r="4"/><circle cx="345" cy="390" r="5"/></g><g fill="#fff" opacity=".06"><circle cx="300" cy="150" r="3"/><circle cx="150" cy="300" r="2.5"/><circle cx="380" cy="250" r="2"/></g>`,

  // Stress — soft layered horizontal waves (calm water)
  stress: `<g opacity=".05" fill="#fff"><path d="M0 200 Q125 180 250 200 Q375 220 500 200 L500 220 Q375 240 250 220 Q125 200 0 220Z"/><path d="M0 260 Q125 240 250 260 Q375 280 500 260 L500 280 Q375 300 250 280 Q125 260 0 280Z"/><path d="M0 320 Q125 300 250 320 Q375 340 500 320 L500 340 Q375 360 250 340 Q125 320 0 340Z"/></g><circle cx="400" cy="140" r="60" fill="#818cf8" opacity=".03"/><circle cx="100" cy="380" r="50" fill="#818cf8" opacity=".025"/>`,

  // Joint — interlocking arc geometry
  joint: `<g opacity=".06" stroke="#fff" stroke-width="1" fill="none"><path d="M180 250 A70 70 0 0 1 250 180"/><path d="M250 180 A70 70 0 0 1 320 250"/><path d="M320 250 A70 70 0 0 1 250 320"/><path d="M250 320 A70 70 0 0 1 180 250"/></g><g opacity=".04" stroke="#fff" stroke-width=".6" fill="none"><circle cx="250" cy="250" r="45"/><circle cx="250" cy="250" r="90"/></g><circle cx="250" cy="250" r="8" fill="#fff" opacity=".06"/><g fill="#fff" opacity=".03"><circle cx="180" cy="250" r="6"/><circle cx="320" cy="250" r="6"/><circle cx="250" cy="180" r="6"/><circle cx="250" cy="320" r="6"/></g>`,

  // Heart — rhythmic pulse wave with soft glow
  heart: `<g opacity=".06" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M60 260 L160 260 L190 260 L210 200 L230 320 L250 180 L270 300 L290 240 L310 260 L340 260 L440 260"/></g><g opacity=".03" fill="#ef4444"><ellipse cx="250" cy="260" rx="120" ry="50"/></g><circle cx="250" cy="260" r="6" fill="#fff" opacity=".08"/><g opacity=".03" stroke="#fff" stroke-width=".5" fill="none"><ellipse cx="250" cy="260" rx="160" ry="80"/><ellipse cx="250" cy="260" rx="200" ry="100"/></g>`,

  // Skin — layered soft petal/bloom shapes
  skin: `<g opacity=".04" fill="#fff"><ellipse cx="250" cy="240" rx="90" ry="70" transform="rotate(0 250 240)"/><ellipse cx="250" cy="240" rx="90" ry="70" transform="rotate(60 250 240)"/><ellipse cx="250" cy="240" rx="90" ry="70" transform="rotate(120 250 240)"/></g><circle cx="250" cy="240" r="30" fill="#f9a8d4" opacity=".05"/><circle cx="250" cy="240" r="15" fill="#fff" opacity=".04"/><g fill="#f9a8d4" opacity=".04"><circle cx="170" cy="160" r="20"/><circle cx="340" cy="180" r="18"/><circle cx="190" cy="330" r="15"/><circle cx="320" cy="310" r="17"/></g>`,

  // Weight — ascending diagonal flow with gradient steps
  weight: `<g opacity=".05" stroke="#fff" stroke-width="1" fill="none" stroke-linecap="round"><path d="M80 400 Q140 380 180 340 Q220 300 260 280 Q300 260 340 220 Q380 180 420 100"/></g><g opacity=".04" fill="#fff"><circle cx="130" cy="370" r="8"/><circle cx="220" cy="310" r="7"/><circle cx="300" cy="250" r="6"/><circle cx="380" cy="180" r="5"/><circle cx="420" cy="100" r="4"/></g><g opacity=".03" stroke="#fff" stroke-width=".5" fill="none"><path d="M80 400 L420 100"/></g><g opacity=".025" fill="#38bdf8"><rect x="110" y="350" width="40" height="50" rx="6"/><rect x="200" y="290" width="40" height="60" rx="6"/><rect x="290" y="230" width="40" height="70" rx="6"/><rect x="370" y="150" width="40" height="80" rx="6"/></g>`,

  // Fitness — stacked angular chevrons (upward momentum)
  fitness: `<g opacity=".05" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round"><polyline points="150,320 250,240 350,320"/><polyline points="150,280 250,200 350,280"/><polyline points="150,240 250,160 350,240"/></g><g opacity=".03" fill="#fff"><path d="M150,320 L250,240 L350,320 L350,300 L250,220 L150,300Z"/></g><circle cx="250" cy="200" r="40" fill="#60a5fa" opacity=".03"/>`,

  // Mood — sunrise/horizon with radiating warm arcs
  mood: `<circle cx="250" cy="360" r="80" fill="#fb923c" opacity=".06"/><circle cx="250" cy="360" r="60" fill="#fff" opacity=".03"/><g opacity=".05" stroke="#fff" stroke-width="1" fill="none"><path d="M100 360 A150 150 0 0 1 400 360"/><path d="M130 360 A120 120 0 0 1 370 360"/><path d="M160 360 A90 90 0 0 1 340 360"/></g><g opacity=".04" stroke="#fbbf24" stroke-width=".6" fill="none" stroke-linecap="round"><path d="M250 280 L250 250"/><path d="M300 290 L320 265"/><path d="M200 290 L180 265"/><path d="M340 320 L365 305"/><path d="M160 320 L135 305"/></g>`,

  // Bone — tessellated triangular lattice (structural)
  bone: `<g opacity=".05" stroke="#fff" stroke-width=".6" fill="none"><path d="M150 160 L250 160 L200 240Z"/><path d="M250 160 L350 160 L300 240Z"/><path d="M200 240 L300 240 L250 320Z"/><path d="M100 240 L200 240 L150 320Z"/><path d="M300 240 L400 240 L350 320Z"/><path d="M150 320 L250 320 L200 400Z"/><path d="M250 320 L350 320 L300 400Z"/></g><g fill="#fff" opacity=".03"><circle cx="200" cy="200" r="4"/><circle cx="300" cy="200" r="4"/><circle cx="250" cy="280" r="4"/><circle cx="150" cy="280" r="3"/><circle cx="350" cy="280" r="3"/></g>`,

  // Hair — flowing organic curves (like strands catching light)
  hair: `<g opacity=".05" stroke="#fff" stroke-width="1" fill="none" stroke-linecap="round"><path d="M150 80 Q160 200 200 320 Q220 400 250 450"/><path d="M200 60 Q210 180 230 290 Q250 380 270 440"/><path d="M250 50 Q255 170 260 280 Q265 370 270 430"/><path d="M300 60 Q295 180 280 290 Q260 380 240 440"/><path d="M350 80 Q340 200 310 320 Q290 400 260 450"/></g><g opacity=".04" fill="#f472b6"><circle cx="180" cy="200" r="8"/><circle cx="280" cy="180" r="6"/><circle cx="230" cy="300" r="7"/><circle cx="310" cy="280" r="5"/></g>`,

  // Aging — expanding concentric rings (like tree rings / time)
  aging: `<g opacity=".04" stroke="#fff" stroke-width=".6" fill="none"><circle cx="250" cy="250" r="30"/><circle cx="250" cy="250" r="55"/><circle cx="250" cy="250" r="80"/><circle cx="250" cy="250" r="105"/><circle cx="250" cy="250" r="130"/><circle cx="250" cy="250" r="160"/></g><g opacity=".05" fill="#93c5fd"><circle cx="250" cy="250" r="10"/></g><g opacity=".03" stroke="#fff" stroke-width="1" fill="none" stroke-dasharray="4 8"><circle cx="250" cy="250" r="190"/></g><g fill="#fff" opacity=".04"><circle cx="280" cy="220" r="2"/><circle cx="220" cy="280" r="2"/><circle cx="300" cy="270" r="1.5"/><circle cx="200" cy="220" r="1.5"/></g>`
};

const THEMES = {
  Sleep:             {bg1:'#1a0a3e',bg2:'#2d1b69',a1:'#7c3aed',a2:'#4338ca',bc:['#5b21b6','#8b5cf6','#5b21b6'],el:'sleep'},
  Energy:            {bg1:'#451a03',bg2:'#78350f',a1:'#f59e0b',a2:'#d97706',bc:['#92400e','#d97706','#92400e'],el:'energy'},
  Focus:             {bg1:'#0c2d48',bg2:'#1a5276',a1:'#2980b9',a2:'#1abc9c',bc:['#1a5276','#2980b9','#1a5276'],el:'focus'},
  Recovery:          {bg1:'#451a03',bg2:'#7c3a12',a1:'#ea580c',a2:'#dc2626',bc:['#9a3412','#ea580c','#9a3412'],el:'recovery'},
  Immunity:          {bg1:'#052e16',bg2:'#14532d',a1:'#22c55e',a2:'#16a34a',bc:['#166534','#22c55e','#166534'],el:'immunity'},
  'Gut Health':      {bg1:'#1a2e05',bg2:'#365314',a1:'#84cc16',a2:'#65a30d',bc:['#3f6212','#84cc16','#3f6212'],el:'gut'},
  'Stress Relief':   {bg1:'#1e1b4b',bg2:'#312e81',a1:'#818cf8',a2:'#6366f1',bc:['#3730a3','#818cf8','#3730a3'],el:'stress'},
  'Joint Health':    {bg1:'#1c1917',bg2:'#44403c',a1:'#a8a29e',a2:'#78716c',bc:['#57534e','#a8a29e','#57534e'],el:'joint'},
  'Heart Health':    {bg1:'#450a0a',bg2:'#7f1d1d',a1:'#ef4444',a2:'#dc2626',bc:['#991b1b','#ef4444','#991b1b'],el:'heart'},
  'Skin & Beauty':   {bg1:'#4a044e',bg2:'#701a75',a1:'#e879f9',a2:'#d946ef',bc:['#86198f','#d946ef','#86198f'],el:'skin'},
  'Weight Management':{bg1:'#0c4a6e',bg2:'#075985',a1:'#38bdf8',a2:'#0ea5e9',bc:['#0369a1','#38bdf8','#0369a1'],el:'weight'},
  Fitness:           {bg1:'#1e3a5f',bg2:'#1e40af',a1:'#60a5fa',a2:'#3b82f6',bc:['#1d4ed8','#60a5fa','#1d4ed8'],el:'fitness'},
  Mood:              {bg1:'#431407',bg2:'#7c2d12',a1:'#fb923c',a2:'#f97316',bc:['#c2410c','#fb923c','#c2410c'],el:'mood'},
  'Bone Health':     {bg1:'#1c1917',bg2:'#292524',a1:'#d6d3d1',a2:'#a8a29e',bc:['#44403c','#a8a29e','#44403c'],el:'bone'},
  'Hair & Nails':    {bg1:'#500724',bg2:'#831843',a1:'#f472b6',a2:'#ec4899',bc:['#9d174d','#ec4899','#9d174d'],el:'hair'},
  'Healthy Aging':   {bg1:'#172554',bg2:'#1e3a8a',a1:'#93c5fd',a2:'#60a5fa',bc:['#1e40af','#60a5fa','#1e40af'],el:'aging'}
};

const PRODUCT_CATALOG = {
  Focus: {brand:'HOST DEFENSE',name:'Lion\u2019s Mane, Memory & Nerve Support, 60 Caps',rating:'4.6',reviews:'3,241',priceWas:'$29.95',priceNow:'$20.97',discount:'30% OFF',discountSub:'Personalized for you',title:'Sharpen your<br>mental clarity',desc:'A personalized find to support your cognitive performance goals',insight:'Lion\u2019s Mane mushroom is renowned for supporting Nerve Growth Factor (NGF) production \u2014 essential for brain cell maintenance and cognitive function. Host Defense uses organic mycelium grown in the USA. This pairs well with omega-3s for complementary cognitive pathways.',url:'https://www.iherb.com/pr/21455'},
  Sleep: {brand:'DOCTOR\u2019S BEST',name:'High Absorption Magnesium Glycinate, 240mg, 180 Tabs',rating:'4.7',reviews:'8,912',priceWas:'$19.99',priceNow:'$14.99',discount:'25% OFF',discountSub:'Discovered just for you',title:'Rest deeper<br>every night',desc:'A science-backed recommendation for your sleep quality goals',insight:"Magnesium glycinate is the most bioavailable form with calming effects on the nervous system. This chelated form is bound to glycine \u2014 itself a calming amino acid \u2014 for dual relaxation support. Gentler on the stomach and better absorbed at bedtime than oxide.",url:'https://www.iherb.com/pr/16567'},
  Recovery: {brand:'LIFE EXTENSION',name:'Super Bio-Curcumin, Turmeric Extract, 60 Caps',rating:'4.7',reviews:'2,834',priceWas:'$28.00',priceNow:'FREE',discount:'FREE SAMPLE',discountSub:'Try with your next order',title:'Recover faster,<br>feel stronger',desc:'A targeted recommendation for your post-workout recovery',insight:"This bio-enhanced curcumin delivers up to 7x more free curcuminoids than standard turmeric. The patented BCM-95 technology solves curcumin\u2019s bioavailability problem without black pepper. Meaningfully reduces post-exercise soreness and joint stiffness.",url:'https://www.iherb.com/pr/15211'},
  Energy: {brand:'DOCTOR\u2019S BEST',name:'High Absorption CoQ10 with BioPerine, 200mg, 120 Softgels',rating:'4.8',reviews:'6,547',priceWas:'$26.99',priceNow:'$19.99',discount:'26% OFF',discountSub:'Personalized for you',title:'Power through<br>your day',desc:'A targeted recommendation to support your natural energy levels',insight:"CoQ10 is essential for mitochondrial energy production in every cell. Levels naturally decline after age 30. This form uses natural trans-isomer CoQ10 with BioPerine for enhanced absorption \u2014 supporting cellular energy, heart function, and antioxidant defense.",url:'https://www.iherb.com/pr/10930'},
  Immunity: {brand:'NATURE\u2019S WAY',name:'Sambucus Elderberry Gummies, 60ct',rating:'4.6',reviews:'4,218',priceWas:'$16.49',priceNow:'$11.54',discount:'30% OFF',discountSub:'Seasonal immunity pick',title:'Strengthen your<br>defenses',desc:'A timely recommendation to support your immune resilience',insight:"Sambucus black elderberry provides concentrated anthocyanins that support immune cell signaling and healthy cytokine response. Each gummy delivers a standardized extract equivalent to 3.2g of elderberry \u2014 especially effective during seasonal transitions and cold months.",url:'https://www.iherb.com/pr/82513'},
  'Gut Health': {brand:'CALIFORNIA GOLD NUTRITION',name:'LactoBif 30 Probiotics, 30 Billion CFU, 60 Caps',rating:'4.6',reviews:'11,234',priceWas:'$18.00',priceNow:'$13.50',discount:'25% OFF',discountSub:'Discovered just for you',title:'Nourish your<br>microbiome',desc:'A science-backed pick to support your digestive wellness',insight:"This delivers 8 active probiotic strains including 5 Lactobacilli and 3 Bifidobacteria at 30 billion CFU. Fermented in Wisconsin and third-party tested for purity. The delayed-release capsules survive stomach acid to reach your intestines where they\u2019re needed.",url:'https://www.iherb.com/pr/64009'},
  'Stress Relief': {brand:'NOW FOODS',name:'Ashwagandha Stress Relief, 60 Caps',rating:'4.5',reviews:'5,891',priceWas:'$18.99',priceNow:'$13.29',discount:'30% OFF',discountSub:'Personalized for you',title:'Find your<br>calm center',desc:'A personalized recommendation to help manage daily stress',insight:"Ashwagandha (KSM-66) is an adaptogen clinically shown to reduce cortisol levels by up to 30% in 60 days. This standardized extract supports GABA pathways and HPA axis regulation \u2014 helping your body adapt to daily stressors rather than just masking symptoms.",url:'https://www.iherb.com/pr/114126'},
  'Joint Health': {brand:'DOCTOR\u2019S BEST',name:'Glucosamine Chondroitin MSM with OptiMSM, 120 Caps',rating:'4.5',reviews:'3,876',priceWas:'$16.99',priceNow:'$11.89',discount:'30% OFF',discountSub:'Matched to your goals',title:'Move with<br>ease again',desc:'A targeted recommendation for your joint comfort goals',insight:"This triple-action formula combines glucosamine sulfate for cartilage building, chondroitin for cushioning, and OptiMSM (the purest form of MSM) for flexibility. Studies show this combination provides more comprehensive joint support than any single ingredient alone.",url:'https://www.iherb.com/pr/22'},
  'Heart Health': {brand:'SPORTS RESEARCH',name:'Omega-3 Fish Oil, Triple Strength, 1250mg, 90 Softgels',rating:'4.8',reviews:'9,456',priceWas:'$24.95',priceNow:'$17.47',discount:'30% OFF',discountSub:'Personalized for you',title:'Support your<br>heart daily',desc:'A premium recommendation for your cardiovascular wellness',insight:"Triple strength delivers 1040mg EPA+DHA per softgel in triglyceride form \u2014 the most bioavailable omega-3 format. IFOS 5-Star certified for purity with zero detectable mercury. EPA supports healthy inflammatory response while DHA maintains arterial flexibility.",url:'https://www.iherb.com/pr/90284'},
  'Skin & Beauty': {brand:'VITAL PROTEINS',name:'Collagen Peptides, Unflavored, 20oz (567g)',rating:'4.7',reviews:'15,234',priceWas:'$47.00',priceNow:'$35.25',discount:'25% OFF',discountSub:'Discovered just for you',title:'Glow from<br>the inside',desc:'A personalized pick to support your skin and beauty goals',insight:"Hydrolyzed collagen peptides from grass-fed, pasture-raised bovine are broken down for optimal absorption. Studies show 10g daily for 8 weeks measurably increases skin elasticity and hydration. Dissolves easily in coffee, smoothies, or water with no taste.",url:'https://www.iherb.com/pr/71356'},
  'Weight Management': {brand:'GARDEN OF LIFE',name:'Raw Organic Fiber, 15 Superfoods, 30 Servings',rating:'4.3',reviews:'2,678',priceWas:'$22.99',priceNow:'$16.09',discount:'30% OFF',discountSub:'Matched to your goals',title:'Support healthy<br>metabolism',desc:'A science-backed recommendation for your weight management goals',insight:"This blend of 15 organic superfoods delivers both soluble and insoluble fiber, promoting satiety and healthy blood sugar response after meals. Raw and unprocessed to preserve naturally-occurring enzymes. Adding fiber before meals is one of the most evidence-backed approaches to weight management.",url:'https://www.iherb.com/pr/42839'},
  Fitness: {brand:'OPTIMUM NUTRITION',name:'Micronized Creatine Powder, Unflavored, 300g (60 Servings)',rating:'4.5',reviews:'4,891',priceWas:'$17.99',priceNow:'$12.59',discount:'30% OFF',discountSub:'Personalized for you',title:'Elevate your<br>performance',desc:'A targeted pick to help you get more from every workout',insight:"Creatine monohydrate is the single most researched sports supplement with over 500 studies. Micronized for supreme absorbency, it increases phosphocreatine stores in muscle for high-intensity efforts. 5g daily saturates muscles in about 4 weeks \u2014 expect measurable strength gains.",url:'https://www.iherb.com/pr/36132'},
  Mood: {brand:'NOW FOODS',name:'Mood Support with St. John\u2019s Wort, 90 Caps',rating:'4.4',reviews:'3,456',priceWas:'$22.99',priceNow:'$17.24',discount:'25% OFF',discountSub:'Discovered just for you',title:'Brighten your<br>outlook',desc:'A science-backed recommendation for emotional wellness',insight:"This comprehensive mood formula combines St. John\u2019s Wort (standardized to 0.3% hypericin) with 5-HTP and valerian root. St. John\u2019s Wort supports serotonin availability while 5-HTP provides the building blocks for neurotransmitter synthesis \u2014 a synergistic duo for emotional balance.",url:'https://www.iherb.com/pr/8214'},
  'Bone Health': {brand:'NATURE\u2019S BOUNTY',name:'Calcium Plus Vitamin D3, 1200mg, 220 Softgels',rating:'4.6',reviews:'4,567',priceWas:'$17.40',priceNow:'$12.18',discount:'30% OFF',discountSub:'Personalized for you',title:'Build stronger<br>foundations',desc:'A whole-food recommendation for your bone health goals',insight:"Each softgel delivers 1200mg calcium alongside 25mcg (1000 IU) vitamin D3 for optimal absorption. D3 is essential \u2014 without it, your body absorbs only 10-15% of dietary calcium. The liquid softgel form provides faster absorption than traditional calcium tablets.",url:'https://www.iherb.com/pr/32226'},
  'Hair & Nails': {brand:'SPORTS RESEARCH',name:'Biotin 5000mcg with Coconut Oil, 120 Softgels',rating:'4.7',reviews:'7,432',priceWas:'$15.95',priceNow:'$11.96',discount:'25% OFF',discountSub:'Discovered just for you',title:'Strengthen &<br>nourish',desc:'A targeted recommendation for hair and nail vitality',insight:"Biotin at 5000mcg is well above the minimum \u2014 this therapeutic dose supports keratin infrastructure, the protein that builds hair and nails. The organic virgin coconut oil base improves fat-soluble biotin absorption by up to 3x compared to standard tablets. Non-GMO verified.",url:'https://www.iherb.com/pr/66498'},
  'Healthy Aging': {brand:'CALIFORNIA GOLD NUTRITION',name:'NMN Complex with Resveratrol, 60 Caps',rating:'4.5',reviews:'1,567',priceWas:'$45.00',priceNow:'FREE',discount:'FREE SAMPLE',discountSub:'Try with your next order',title:'Age on your<br>own terms',desc:'A cutting-edge recommendation for your longevity goals',insight:"NMN (nicotinamide mononucleotide) is a direct precursor to NAD+ \u2014 a coenzyme essential for cellular energy and DNA repair that declines with age. Combined with trans-resveratrol for synergistic sirtuin activation. This matches dosages used in clinical trials showing improved cellular metabolism.",url:'https://www.iherb.com/pr/137778'}
};

function bottleSVG(c1, c2, lc) {
  return `<svg viewBox="0 0 60 72" xmlns="http://www.w3.org/2000/svg">
    <defs><linearGradient id="bsh${c1.slice(1)}" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#fff" stop-opacity=".15"/><stop offset="50%" stop-color="#fff" stop-opacity="0"/><stop offset="100%" stop-color="#000" stop-opacity=".1"/></linearGradient></defs>
    <rect x="18" y="2" width="24" height="10" rx="3" fill="${c1}" opacity=".7"/>
    <rect x="20" y="4" width="20" height="6" rx="2" fill="${c1}"/>
    <rect x="12" y="12" width="36" height="56" rx="5" fill="${c1}"/>
    <rect x="12" y="12" width="36" height="56" rx="5" fill="url(#bsh${c1.slice(1)})"/>
    <rect x="16" y="24" width="28" height="28" rx="3" fill="#fff" opacity=".92"/>
    <rect x="20" y="29" width="20" height="2.5" rx="1" fill="${lc}" opacity=".7"/>
    <rect x="20" y="34" width="16" height="2" rx="1" fill="${lc}" opacity=".4"/>
    <rect x="20" y="39" width="20" height="2" rx="1" fill="${lc}" opacity=".4"/>
    <rect x="20" y="44" width="12" height="2" rx="1" fill="${lc}" opacity=".3"/>
  </svg>`;
}

// ── Card engine ──
let CARDS = [], currentIdx = 0, revealed = 0;

function buildCardsFromGoals() {
  return activeGoals.slice(0, 3).map(goal => {
    const t = THEMES[goal] || THEMES['Focus'];
    const p = PRODUCT_CATALOG[goal] || PRODUCT_CATALOG['Focus'];
    const elKey = t.el || 'focus';
    const sceneEl = SCENE_ELEMENTS[elKey] || '';
    const uid = elKey + Math.random().toString(36).slice(2,6);
    return {
      sceneFn: () => makeScene(uid, t.bg1, t.bg2, t.a1, t.a2, sceneEl),
      heroFn: () => makeHero(uid, t.bg1, t.bg2, t.a1),
      bottleColors: t.bc,
      goalLabel: goal, goalBadge: `Matched to your ${goal} goal`,
      title: p.title, desc: p.desc,
      discount: p.discount, discountSub: p.discountSub,
      brand: p.brand, name: p.name,
      rating: p.rating, reviews: p.reviews,
      priceWas: p.priceWas, priceNow: p.priceNow,
      insight: p.insight, expires: '23:59:47',
      url: p.url || '#'
    };
  });
}

function resetAndBuildCards() {
  currentIdx = 0; revealed = 0;
  CARDS = buildCardsFromGoals();
  const stack = document.getElementById('cardStack');
  stack.innerHTML = '';
  document.getElementById('emptyState').classList.remove('visible');
  stack.classList.remove('collapsed');
  CARDS.forEach((d, i) => stack.appendChild(makeCard(d, i)));
  updateRemaining();
  updateProgressDots();
}

function makeCard(d, i) {
  const el = document.createElement('div');
  el.className = 'scratch-card ' + (i===0?'active':i===1?'behind-1':'behind-2');
  el.dataset.index = i;
  el.innerHTML = `
    <div class="card-front" onclick="revealCard(${i})">
      ${d.sceneFn()}
      <div class="card-front-overlay"></div>
      <div class="card-front-content">
        <div class="card-front-tag"><span class="tag-dot"></span> ${d.goalLabel} Goal</div>
        <div class="card-front-title">${d.title}</div>
        <div class="card-front-desc">${d.desc}</div>
        <div class="card-front-cta">
          Tap to reveal
          <span class="cta-arrow"><svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg></span>
        </div>
      </div>
    </div>
    <div class="card-back">
      <div class="reveal-hero">
        ${d.heroFn()}
        <div class="reveal-hero-overlay"></div>
        <div class="reveal-hero-content">
          <div class="reveal-goal-pill">${d.goalBadge}</div>
          <div class="reveal-discount">${d.discount}</div>
          <div class="reveal-discount-sub">${d.discountSub}</div>
        </div>
      </div>
      <div class="reveal-body">
        <div class="product-card">
          <div class="product-thumb-wrap">${bottleSVG(...d.bottleColors)}</div>
          <div class="product-details">
            <div class="product-brand">${d.brand}</div>
            <div class="product-name">${d.name}</div>
            <div class="product-rating"><span class="stars">\u2605\u2605\u2605\u2605\u2605</span> ${d.rating} (${d.reviews})</div>
            <div class="product-pricing">
              <span class="price-was">${d.priceWas}</span>
              <span class="price-now">${d.priceNow}</span>
            </div>
          </div>
        </div>
        <div class="ai-insight">
          <div class="ai-label">
            <span class="ai-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round"><path d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"/></svg></span>
            Personalized Insight
          </div>
          <div class="ai-text-wrap"><div class="ai-text"><span class="tw" data-full="${d.insight}"></span><span class="ai-cursor"></span></div></div>
        </div>
        <div class="cta-stack">
          <button class="btn-add" onclick="addToCart(this,${i})">Add to Cart \u2014 ${d.priceNow}</button>
          <button class="btn-save" onclick="saveForLater(${i})">Save for Later</button>
        </div>
      </div>
      <div class="timer-strip">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
        Offer expires in <strong style="margin-left:4px" class="timer-value">${d.expires}</strong>
      </div>
    </div>
  `;
  return el;
}

function promoteBehindCards() {
  document.querySelectorAll('.scratch-card').forEach(c => {
    const idx = +c.dataset.index;
    c.classList.remove('behind-1','behind-2','active');
    if (idx === currentIdx) c.classList.add('active');
    else if (idx === currentIdx+1) c.classList.add('behind-1');
    else if (idx === currentIdx+2) c.classList.add('behind-2');
  });
}

function revealCard(index) {
  const card = document.querySelector(`.scratch-card[data-index="${index}"]`);
  if (!card || card.dataset.revealed==='1') return;
  card.dataset.revealed = '1';
  card.querySelector('.card-front').style.display = 'none';
  card.querySelector('.card-back').style.display = 'block';
  doConfetti(); revealed++; updateRemaining(); updateProgressDots();
  document.getElementById('progressDots').style.display = 'none';
  document.getElementById('cardsRemaining').style.display = 'none';
  if (navigator.vibrate) navigator.vibrate(15);

  const tw = card.querySelector('.tw'), cur = card.querySelector('.ai-cursor');
  const wrap = card.querySelector('.ai-text-wrap');
  const text = tw.dataset.full;
  tw.textContent = text;
  requestAnimationFrame(() => {
    const fullH = wrap.scrollHeight;
    wrap.style.minHeight = fullH + 'px';
    tw.textContent = '';
    let ci = 0;
    const iv = setInterval(() => {
      if (ci < text.length) { tw.textContent += text[ci]; ci++; }
      else { clearInterval(iv); setTimeout(() => { if(cur) cur.style.display='none'; }, 1000); }
    }, 10);
  });

  // Start countdown timer
  startTimer(card.querySelector('.timer-value'));
}

// ── Live countdown timer ──
function startTimer(el) {
  if (!el) return;
  const parts = el.textContent.split(':').map(Number);
  let totalSec = parts[0]*3600 + parts[1]*60 + parts[2];
  const iv = setInterval(() => {
    totalSec--;
    if (totalSec <= 0) { clearInterval(iv); el.textContent = '00:00:00'; return; }
    const h = Math.floor(totalSec/3600), m = Math.floor((totalSec%3600)/60), s = totalSec%60;
    el.textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }, 1000);
}

function addToCart(btn, index) {
  btn.innerHTML = '<svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"><path d="M20 6L9 17l-5-5"/></svg> Added to Cart';
  btn.classList.add('added');
  btn.style.pointerEvents = 'none';
  if (navigator.vibrate) navigator.vibrate([10,50,10]);
  toast('Added to cart with your personal discount');
  setTimeout(() => advance(index), 1400);
}

function saveForLater(index) {
  toast('Saved to your discoveries');
  setTimeout(() => advance(index), 700);
}

function advance(index) {
  const card = document.querySelector(`.scratch-card[data-index="${index}"]`);
  card.classList.remove('active');
  card.classList.add('dismissed', 'slide-out');
  currentIdx++;
  promoteBehindCards();
  if (currentIdx >= CARDS.length) {
    document.getElementById('emptyState').classList.add('visible');
    document.getElementById('cardStack').classList.add('collapsed');
  } else {
    document.getElementById('progressDots').style.display = '';
    document.getElementById('cardsRemaining').style.display = '';
  }
  updateRemaining();
  updateProgressDots();
}

function updateRemaining() {
  const r = CARDS.length - revealed;
  document.getElementById('cardsRemaining').innerHTML = r>0 && currentIdx<CARDS.length
    ? `<strong>${r}</strong> pick${r!==1?'s':''} remaining today` : '';
}

function updateProgressDots() {
  const container = document.getElementById('progressDots');
  container.innerHTML = CARDS.map((_, i) => {
    let cls = 'progress-dot';
    if (i === currentIdx) cls += ' active';
    else if (i < currentIdx) cls += ' done';
    return `<div class="${cls}"></div>`;
  }).join('');
}

function toast(msg) {
  const t = document.getElementById('toast');
  t.innerHTML = `<span class="toast-icon"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"><path d="M20 6L9 17l-5-5"/></svg></span> ${msg}`;
  t.classList.add('visible');
  setTimeout(() => t.classList.remove('visible'), 2600);
}

function doConfetti() {
  const c = document.getElementById('confetti');
  const colors = ['#46820b','#5a9e14','#d4a017','#f0d060','#ef4444','#3b82f6','#8b5cf6','#14b8a6','#f59e0b','#ec4899'];
  for (let i=0;i<55;i++) {
    const p = document.createElement('div'); p.className='confetti-piece';
    const size = Math.random()*8+3;
    const spinDir = Math.random() > .5 ? '' : '-';
    p.style.cssText=`left:${Math.random()*100}%;width:${size}px;height:${size}px;background:${colors[Math.floor(Math.random()*colors.length)]};border-radius:${Math.random()>.5?'50%':'2px'};animation-delay:${Math.random()*.6}s;--fall-duration:${Math.random()*1.2+2}s;--spin:${spinDir}${Math.random()*360+360}deg;`;
    c.appendChild(p); setTimeout(()=>p.remove(),3600);
  }
}

// ── Goals Editor ──
const ALL_GOALS = [
  'Sleep','Energy','Focus','Recovery','Immunity','Gut Health',
  'Stress Relief','Joint Health','Heart Health','Skin & Beauty',
  'Weight Management','Fitness','Mood','Bone Health','Hair & Nails','Healthy Aging'
];

let activeGoals = ['Sleep','Energy','Focus','Recovery'];
let tempGoals = [];

function renderGoalsDisplay() {
  document.getElementById('goalsDisplay').innerHTML = activeGoals.map(g => `<div class="goal-tag">${g}</div>`).join('');
}

function openGoalsEditor() {
  tempGoals = [...activeGoals];
  renderGoalsGrid();
  updateGoalsCount();
  document.getElementById('goalsModal').classList.add('open');
}

function closeGoalsEditor() {
  const modal = document.getElementById('goalsModal');
  const sheet = modal.querySelector('.goals-modal');
  sheet.style.animation = 'none';
  sheet.offsetHeight;
  sheet.style.animation = 'sheet-down .3s var(--ease-out-expo) forwards';
  setTimeout(() => {
    modal.classList.remove('open');
    sheet.style.animation = '';
  }, 280);
}

// Sheet-down animation
const sheetStyle = document.createElement('style');
sheetStyle.textContent = '@keyframes sheet-down{0%{transform:translateY(0);opacity:1}100%{transform:translateY(100%);opacity:.5}}';
document.head.appendChild(sheetStyle);

function renderGoalsGrid() {
  const grid = document.getElementById('goalsGrid');
  grid.innerHTML = ALL_GOALS.map(g => {
    const sel = tempGoals.includes(g) ? 'selected' : '';
    return `<button class="goal-option ${sel}" onclick="toggleGoal('${g}', this)">
      <span class="goal-check"><svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="${sel ? 'var(--green-600)' : '#fff'}" stroke-width="3" stroke-linecap="round"><path d="M20 6L9 17l-5-5"/></svg></span>
      ${g}
    </button>`;
  }).join('');
}

function toggleGoal(goal, btn) {
  const idx = tempGoals.indexOf(goal);
  if (idx > -1) {
    tempGoals.splice(idx, 1);
    btn.classList.remove('selected');
    btn.querySelector('.goal-check svg').setAttribute('stroke', '#fff');
  } else {
    tempGoals.push(goal);
    btn.classList.add('selected');
    btn.querySelector('.goal-check svg').setAttribute('stroke', 'var(--green-600)');
  }
  if (navigator.vibrate) navigator.vibrate(5);
  updateGoalsCount();
}

function updateGoalsCount() {
  const n = tempGoals.length;
  document.getElementById('goalsCount').textContent = n === 0 ? 'Select at least one goal' : `${n} goal${n !== 1 ? 's' : ''} selected`;
}

function saveGoals() {
  if (tempGoals.length === 0) { toast('Please select at least one goal'); return; }
  activeGoals = [...tempGoals];
  renderGoalsDisplay();
  closeGoalsEditor();
  setTimeout(() => {
    resetAndBuildCards();
    toast('Goals updated \u2014 here are your new reveals!');
  }, 300);
}

renderGoalsDisplay();
resetAndBuildCards();
</script>
</body>
</html>
